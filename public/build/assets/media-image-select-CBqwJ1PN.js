import{r as i,a as h,U as O,j as e,V as o}from"./app-BYmXcSnL.js";import{D as se,a as le,b as re,c as oe,d as ie,e as ne}from"./dialog-vRlR396N.js";import{B as f}from"./button-kL7g9wpY.js";import{u as de,T as ce,a as me,b as C,c as S,d as pe,M as ue,I as xe}from"./media-cropper-cIBQcVg0.js";import{S as he,a as fe,D as ge}from"./delete-dialog-Cx2NJSnk.js";import{I as T}from"./input-oj-noHxe.js";import{f as E}from"./helpers-gu3OCxCZ.js";import{L as D}from"./loader-circle-DHu_gza0.js";const je=({onClose:N,onConfirm:g})=>{const[m,n]=i.useState([]),[a,d]=i.useState(null),[p,c]=i.useState(!1),[k,L]=i.useState(!0),[P,B]=i.useState(1),[R,A]=i.useState(!0),[j,I]=i.useState(""),V=m.length?m.filter(t=>t.filename).length:0,[W,U]=i.useState(!1),[y,_]=i.useState(null),[v,z]=i.useState(""),[M,H]=i.useState("");i.useEffect(()=>{const t=setTimeout(()=>{w(1,M)},500);return()=>clearTimeout(t)},[M]);const w=(t,s="")=>{L(!0),h.get(`/media?page=${t}&search=${encodeURIComponent(s)}`).then(l=>{const r=l.data;n(t===1?r.data:u=>[...u,...r.data]),A(r.current_page<r.last_page),B(r.current_page)}).finally(()=>L(!1))},Q=()=>{R&&w(P+1)},q=t=>{if(t.length===0)return;c(!0);const s=t.map(l=>{const r=new FormData;return r.append("image",l),h.post("/media-upload",r)});Promise.allSettled(s).then(l=>{const r=l.filter(x=>x.status==="fulfilled").length,u=l.filter(x=>x.status==="rejected").length;r&&o.success(`${r} file(s) uploaded successfully`),u&&o.error(`${u} file(s) failed to upload`),w(1)}).catch(l=>{console.error("Upload error:",l),o.error("Error uploading files")}).finally(()=>c(!1))};i.useEffect(()=>{I((a==null?void 0:a.name)||"")},[a]);const K=()=>{!a||j===a.name||h.put(`/media/${a.id}`,{name:j}).then(()=>{d({...a,name:j}),n(t=>t.map(s=>s.id===a.id?{...s,name:j}:s)),o.success("Name updated")}).catch(t=>{console.error("Update failed:",t),o.error("Failed to update name"),I(a.name)})},b=O.useRef(null),X=t=>{if(navigator.clipboard)navigator.clipboard.writeText(t).then(()=>{o.success("Copied to clipboard"),b.current&&b.current.select()}).catch(s=>{console.error("Copy failed:",s),o.error("Failed to copy")});else{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.opacity="0",document.body.appendChild(s),s.select();try{document.execCommand("copy"),o.success("Copied to clipboard"),b.current&&b.current.select()}catch(l){console.error("Fallback copy failed:",l),o.error("Copy not supported")}document.body.removeChild(s)}},$=t=>{if(!t||!a)return;const s=new FormData;s.append("image",t),s.append("old_path",a.path),h.post(`/media/${a.id}/update-image`,s).then(l=>{o.success("Image updated");const r={...a,path:l.data.path,updated_at:l.data.updated_at};n(u=>u.map(x=>x.id===a.id?r:x)),d(r)}).catch(()=>o.error("Failed to update image"))},G=()=>{y&&h.delete(`/media/${y.id}`).then(()=>{n(t=>t.filter(s=>s.id!==y.id)),(a==null?void 0:a.id)===y.id&&d(null),o.success("Image deleted")}).catch(()=>o.error("Failed to delete image")).finally(()=>{U(!1),_(null)})},J=()=>{if(!v)return o.error("Please provide a valid image URL");c(!0),h.post("/media-upload-from-url",{url:v}).then(()=>{o.success("Image uploaded from link"),z(""),w(1)}).catch(t=>{console.error("URL upload failed:",t),o.error("Upload from URL failed")}).finally(()=>c(!1))},{getRootProps:Y,getInputProps:Z}=de({onDrop:q,multiple:!0,maxSize:128*1024*1024}),[ee,F]=i.useState(!1),ae=()=>{F(!0)},te=t=>{if(!a)return;const s=a.name||"cropped",l=s.endsWith(".jpg")||s.endsWith(".webp")||s.endsWith(".png")?s:s+".jpg",r=new File([t],l,{type:t.type});$(r),F(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{open:!0,onOpenChange:N,children:e.jsxs(le,{className:"!w-[95vw] !max-w-[95vw] !h-[calc(100vh-2rem)] p-0 flex flex-col overflow-hidden",children:[e.jsx(re,{className:"p-4 border-b",children:e.jsxs(oe,{children:["Feature Images: (",V,")"]})}),e.jsx("div",{className:"px-6 flex-1 overflow-y-auto h-[calc(100vh-2rem)]",children:e.jsxs(ce,{defaultValue:"library",className:"w-full",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 m-4",children:[e.jsxs(me,{className:"sticky top-0 z-10 bg-gray-50 dark:bg-gray-800 flex flex-wrap",children:[e.jsx(C,{value:"upload",className:"text-black dark:text-white",children:"Upload files"}),e.jsx(C,{value:"url",className:"text-black dark:text-white",children:"Upload from Link"}),e.jsx(C,{value:"library",className:"text-black dark:text-white",children:"Media Library"}),e.jsx(C,{value:"optimole",className:"text-black dark:text-white",children:"Optimise"})]}),e.jsx("div",{className:"flex justify-end w-full md:w-auto",children:e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx(T,{type:"text",placeholder:"Search...",className:"pl-10 pr-4",value:M,onChange:t=>H(t.target.value)}),e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16})]})})]}),e.jsx(S,{value:"upload",className:"flex flex-col-1 items-center justify-center",children:e.jsxs("div",{...Y(),className:"border-dashed border-2 border-gray-300 w-full h-full rounded p-15 text-center cursor-pointer bg-gray-50 dark:bg-gray-900",children:[e.jsx("input",{...Z()}),e.jsx("p",{className:"text-lg",children:"Drop files to upload"}),e.jsx("p",{className:"text-sm text-muted-foreground my-2",children:"or"}),e.jsxs(f,{disabled:p,children:[p?e.jsx(D,{className:"animate-spin mr-2"}):null,"Select Files"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Maximum upload file size: 128 MB"})]})}),e.jsx(S,{value:"library",children:k&&m.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(D,{className:"animate-spin h-6 w-6 text-gray-500"})}):e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto max-h-[40rem]",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2",children:m.map(t=>e.jsxs("div",{className:`rounded border-2 relative group overflow-hidden cursor-pointer ${(a==null?void 0:a.id)===t.id?"border-blue-500":"border-transparent"}`,onClick:()=>d(t),children:[e.jsx("img",{src:`/storage/${t.path}?t=${t.updated_at||Date.now()}`,alt:t.name||"Image",className:"w-full h-24 sm:h-32 object-cover"}),e.jsxs("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:ae,type:"button",className:"bg-blue-600 hover:bg-blue-700 text-white text-xs px-2 cursor-pointer py-1 rounded",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>{var r;const l=(r=s.target.files)==null?void 0:r[0];l&&$(l)}})]}),e.jsx("div",{className:"absolute top-1 left-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{className:"px-2 py-1 cursor-pointer bg-red-600 text-xs text-white rounded hover:bg-red-700",onClick:()=>{_(t),U(!0)},children:e.jsx(pe,{className:"w-4 h-4"})})})]},t.id))}),R&&e.jsx("div",{className:"text-center mt-4",children:e.jsx(f,{onClick:Q,variant:"default",disabled:k,className:"cursor-pointer",children:k?e.jsx(D,{className:"animate-spin"}):"Load More"})})]}),a&&e.jsxs("div",{className:"w-64 p-4 border rounded bg-background",children:[e.jsx("img",{src:`/storage/${a.path}`,alt:a.name,className:"w-full h-40 object-cover rounded"}),e.jsx("div",{className:"text-center mt-1",children:e.jsxs("label",{className:"inline-flex items-center px-2 py-1 bg-blue-600 text-white text-xs rounded cursor-pointer hover:bg-blue-700",children:["Replace Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:t=>{var l;const s=(l=t.target.files)==null?void 0:l[0];s&&$(s)}})]})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Name:"}),e.jsx(T,{type:"text",className:"mb-2",value:j,onChange:t=>I(t.target.value),onBlur:K}),e.jsx("p",{className:"font-semibold",children:"Size:"}),e.jsxs("p",{className:"mb-2",children:[(a.size/1024).toFixed(2)," KB"]}),e.jsx("p",{className:"font-semibold",children:"Type:"}),e.jsx("p",{className:"mb-2",children:a.mime_type}),e.jsx("p",{children:e.jsx("strong",{children:"Uploaded:"})}),e.jsx("p",{children:E(a.created_at)}),e.jsx("p",{children:e.jsx("strong",{children:"Updated:"})}),e.jsx("p",{children:E(a.updated_at)}),e.jsx("p",{className:"font-semibold",children:"Dimensions:"}),e.jsxs("p",{className:"mb-2",children:[a.width?a.width:"N/A"," X ",a.height?a.height:"N/A"," px"]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"font-semibold",children:"Full URL:"}),e.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[e.jsx("input",{ref:b,type:"text",readOnly:!0,value:`${window.location.origin}/storage/${a.path}`,className:"flex-1 border rounded px-2 py-1 text-sm truncate min-w-0"}),e.jsx("button",{onClick:()=>X(`${window.location.origin}/storage/${a.path}`),className:"text-xs px-2 py-1 cursor-pointer bg-blue-600 text-white rounded",children:"Copy"})]})]})]})]})]})}),e.jsx(S,{value:"url",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the direct image URL to upload:"}),e.jsxs("div",{className:"flex w-full max-w-md flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsx(T,{type:"url",placeholder:"https://example.com/image.jpg",value:v,onChange:t=>z(t.target.value),className:"flex-1 text-sm"}),e.jsxs(f,{onClick:J,disabled:p||!v,className:"w-full sm:w-auto",children:[p&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload"]})]})]})}),e.jsx(S,{value:"optimole",children:e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"Optimise integration coming soon..."})})]})}),e.jsxs(ie,{className:"border-t p-4 bg-background",children:[e.jsx(ne,{asChild:!0,children:e.jsx(f,{variant:"outline",className:"cursor-pointer",children:"Cancel"})}),e.jsx(f,{className:"cursor-pointer",variant:"default",onClick:()=>a&&g(a),disabled:!a,children:"Set featured image"})]})]})}),e.jsx(ge,{open:W,onClose:()=>U(!1),onConfirm:G,title:"Confirm Deletion",description:"This will permanently remove the image from the system."}),ee&&a&&e.jsx(ue,{imageSrc:`/storage/${a.path}?t=${a.updated_at}`,onCancel:()=>F(!1),onCropComplete:te})]})},ke=({onSelect:N,initial:g})=>{const[m,n]=i.useState(!1),[a,d]=i.useState(g||null),p=c=>{d(c),N(c),n(!1)};return O.useEffect(()=>{d(g||null)},[g]),e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs(f,{type:"button",className:"cursor-pointer",variant:"outline",size:"sm",onClick:()=>n(!0),children:[e.jsx(xe,{}),a?"Change Media":"Add Media"]}),a&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:`/storage/${a.path}`,className:"max-h-fit w-full rounded shadow object-cover",alt:a.name}),e.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{type:"button",onClick:()=>{d(null),N({id:null})},className:"bg-red-600 hover:bg-red-700 text-white text-xs px-2 cursor-pointer py-1 rounded",children:"Remove"})})]}),m&&e.jsx(je,{onClose:()=>n(!1),onConfirm:p})]})};export{je as M,ke as S};
