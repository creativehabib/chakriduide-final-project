import{r,j as e,V as c,a as M,K as V,L as W}from"./app-CPznV8uF.js";import{A as G}from"./app-layout-CN9z5tJE.js";import{D as z,b as O,g as A,c as B,d as q}from"./dialog-DTmEfWlK.js";import{B as _}from"./button-VtRI6xY9.js";import{I as L}from"./input-DFZeNEB7.js";import{u as H,T as K,a as Q,b as E,c as P,d as J,M as Y,I as X}from"./media-cropper-CQYLziKt.js";import{L as F}from"./loader-circle-CWZUcjjT.js";import{a as Z,D as ee,S as se}from"./delete-dialog-CEbso6F_.js";import{f as U}from"./helpers-gu3OCxCZ.js";import{c as T}from"./createLucideIcon-CiPrHNEp.js";import{C as ae}from"./chevron-right-BApF9UWX.js";import"./index-BkxTKK_n.js";import"./index-CQujIz_e.js";import"./x-CyCywIc8.js";import"./index-Co6cJWXf.js";import"./app-logo-icon-BpKmkYy5.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],re=T("ChevronLeft",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ne=T("Loader",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M14 4a2 2 0 0 1 2-2",key:"1w2hp7"}],["path",{d:"M16 10a2 2 0 0 1-2-2",key:"shjach"}],["path",{d:"M20 2a2 2 0 0 1 2 2",key:"188mtx"}],["path",{d:"M22 8a2 2 0 0 1-2 2",key:"ddf4tu"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5a3 3 0 0 1 3-3h1",key:"3y3t5z"}],["rect",{x:"2",y:"14",width:"8",height:"8",rx:"2",key:"4rksxw"}]],ce=T("Replace",oe);function de({open:j,setOpen:p,onUploadComplete:s}){const[l,x]=r.useState(!1),[o,v]=r.useState(""),C=()=>{s&&(s(),p(!1))},h=n=>{if(n.length===0)return;x(!0);const y=n.map(i=>{const u=new FormData;return u.append("image",i),M.post("/media-upload",u)});Promise.allSettled(y).then(i=>{const u=i.filter(N=>N.status==="fulfilled").length,f=i.filter(N=>N.status==="rejected").length;u&&c.success(`${u} file(s) uploaded successfully`),f&&c.error(`${f} file(s) failed to upload`),C()}).catch(i=>{c.error("Error uploading files"+(i instanceof Error?i.message:""))}).finally(()=>x(!1))},{getRootProps:b,getInputProps:w}=H({onDrop:h,multiple:!0,maxSize:128*1024*1024}),D=()=>{if(!o)return c.error("Please provide a valid image URL");x(!0),M.post("/media-upload-from-url",{url:o}).then(n=>{c.success(n.data.success),v(""),C()}).catch(n=>{c.error("Upload from URL failed "+(n instanceof Error?n.message:""))}).finally(()=>x(!1))};return e.jsx(z,{open:j,onOpenChange:p,children:e.jsxs(O,{className:"sm:max-w-[1100px]",children:[e.jsxs(A,{children:[e.jsx(B,{children:"Media Uploader"}),e.jsx(q,{children:"Upload images to your media library. You can upload files directly or from a URL."})]}),e.jsx("div",{className:"",children:e.jsxs(K,{defaultValue:"upload",className:"w-full",children:[e.jsxs(Q,{className:"",children:[e.jsx(E,{value:"upload",children:"Upload Media"}),e.jsx(E,{value:"url",children:"Upload From URL"})]}),e.jsx(P,{value:"upload",children:e.jsx("div",{className:"",children:e.jsxs("div",{...b(),className:"border-dashed border-2 border-gray-300 w-full h-full rounded p-15 text-center cursor-pointer bg-gray-50 dark:bg-gray-900",children:[e.jsx("input",{...w()}),e.jsx("p",{className:"text-lg",children:"Drop files to upload"}),e.jsx("p",{className:"text-sm text-muted-foreground my-2",children:"or"}),e.jsxs(_,{disabled:l,children:[l?e.jsx(F,{className:"animate-spin mr-2"}):null,"Select Files"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Supported formats: JPG, PNG, GIF, WEBP. Maximum file size: 128 MB."})]})})}),e.jsx(P,{value:"url",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the direct image URL to upload:"}),e.jsxs("div",{className:"flex w-full max-w-md flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsx(L,{type:"url",placeholder:"https://example.com/image.jpg",value:o,autoFocus:!0,onChange:n=>v(n.target.value),className:"flex-1 text-sm"}),e.jsxs(_,{onClick:D,disabled:l||!o,className:"w-full sm:w-auto",children:[l&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload"]})]})]})})]})})]})})}const ie=async(j=1,p="")=>(await M.get(`/media?page=${j}&search=${encodeURIComponent(p)}`)).data,me=({open:j,setOpen:p,media:s,mediaList:l,setMedia:x,onMediaUpdate:o})=>{const v=r.useRef(null),[C,h]=r.useState(!1),[b,w]=r.useState(""),[D,n]=r.useState(!1),[y,i]=r.useState(null);if(r.useEffect(()=>{w((s==null?void 0:s.name)||"")},[s]),!s)return null;const u=()=>{!s||b===s.name||M.put(`/media/${s.id}`,{name:b}).then(a=>{o&&o({...s,name:b}),c.success(a.data.success)}).catch(a=>{c.error(a.data.error),w(s.name)})},f=()=>{h(!0)},N=a=>{var g;const m=(g=a.target.files)==null?void 0:g[0];m&&I(m)},I=a=>{if(!s)return;const m=new FormData;m.append("image",a),m.append("old_path",s.path),M.post(`/media/${s.id}/update-image`,m).then(g=>{c.success(g.data.message);const R={...s,path:g.data.path,updated_at:g.data.updated_at};o==null||o(R)}).catch(g=>c.error(g.data.message))},S=a=>{if(!s)return;const m=s.name||"cropped",g=m.endsWith(".jpg")||m.endsWith(".webp")||m.endsWith(".png")?m:m+".jpg",R=new File([a],g,{type:a.type});I(R),h(!1)},$=()=>{y&&M.delete(`/media/${y.id}`).then(a=>{o==null||o(null),c.success(a.data.success)}).catch(a=>c.error(a.data.error)).finally(()=>{n(!1),i(null)})},t=()=>(l==null?void 0:l.findIndex(a=>a.id===s.id))??-1,k=()=>{const a=t();return a>=0&&l&&a<l.length-1?l[a+1]:null},d=()=>{const a=t();return a>0&&l?l[a-1]:null};return e.jsxs(e.Fragment,{children:[e.jsx(z,{open:j,onOpenChange:p,children:e.jsxs(O,{className:"!w-[95vw] !max-w-[95vw] !h-[90vh] p-0 gap-0 rounded flex flex-col overflow-hidden",children:[e.jsx(A,{className:"p-4 shadow-md bg-background border-b ",children:e.jsxs(B,{className:"flex items-center justify-between w-full",children:["Attachment Details",l&&x&&e.jsxs("div",{className:"flex gap-2 mr-10 items-center",children:[e.jsx("button",{className:"text-sm  hover:underline disabled:opacity-50",disabled:!d(),onClick:()=>x(d()),children:e.jsx(re,{})}),e.jsx("button",{className:"text-sm hover:underline disabled={!getNextMedia()}",onClick:()=>x(k()),children:e.jsx(ae,{className:"ml-3"})})]})]})}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 overflow-hidden",children:[e.jsxs("div",{className:"flex-col md:flex items-center justify-center overflow-auto p-6 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-700 space-y-4",children:[e.jsx("img",{src:`/storage/${s.path}?t=${s.updated_at}`,alt:s.name||"Image",className:"max-w-1/2 object-contain rounded-md border border-gray-200 dark:border-gray-700 shadow-sm"}),e.jsx("input",{type:"file",ref:v,accept:"image/*",className:"hidden",onChange:N}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-green-600 text-white text-xs rounded cursor-pointer hover:bg-green-700",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:N}),e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs uppercase",children:"Replace Image"})]}),e.jsxs("button",{onClick:f,type:"button",className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white text-xs rounded hover:bg-blue-700",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"uppercase text-xs",children:"Edit Image"})]})]})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-gray-950 border-t md:border-t-0 md:border-l  overflow-y-auto p-6 space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold dark:text-gray-200",children:"File Name"}),e.jsx(L,{type:"text",className:"mb-2",value:b,onChange:a=>w(a.target.value),onBlur:u})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold dark:text-gray-200",children:"Size"}),e.jsxs("p",{className:" dark:text-gray-400",children:[(s.size/1024).toFixed(2)," KB"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold  dark:text-gray-200",children:"Type"}),e.jsx("p",{className:" dark:text-gray-400",children:s.mime_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold  dark:text-gray-200",children:"Dimensions"}),e.jsxs("p",{className:" dark:text-gray-400",children:[s.width," Ã— ",s.height]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold  dark:text-gray-200",children:"Created At"}),e.jsx("p",{className:" dark:text-gray-400",children:U(s.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold  dark:text-gray-200",children:"Updated At"}),e.jsx("p",{className:" dark:text-gray-400",children:U(s.updated_at)})]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700",onClick:()=>{i(s),n(!0)},children:[e.jsx(J,{className:"w-4 h-4"}),"Delete Permanently"]})]})]})]})}),e.jsx(ee,{open:D,onClose:()=>n(!1),onConfirm:$,title:"Confirm Deletion",description:"This will permanently remove the image from the system."}),C&&s&&e.jsx(Y,{imageSrc:`/storage/${s.path}?t=${s.updated_at}`,onCancel:()=>h(!1),onCropComplete:S})]})},pe=[{title:"Media Library",href:"/get-media"}],Ie=()=>{const[j,p]=r.useState([]),[s,l]=r.useState(!0),[x,o]=r.useState(1),[v,C]=r.useState(!0),[h,b]=r.useState(""),[w,D]=r.useState(!1),[n,y]=r.useState(null),[i,u]=r.useState(!1),{flash:f,count:N}=V().props,I=()=>{S(1)};r.useEffect(()=>{const t=setTimeout(()=>{S(1,h)},500);return()=>clearTimeout(t)},[h]),r.useEffect(()=>{S(1)},[]);const S=async(t=1,k="")=>{l(!0);try{const d=await ie(t,k);p(t===1?d.data:a=>[...a,...d.data]),C(d.current_page<d.last_page),o(d.current_page)}finally{l(!1)}},$=()=>{v&&!s&&S(x+1,h)};return r.useEffect(()=>{f.success&&c.success(f.success),f.error&&c.error(f.error)},[f]),e.jsxs(G,{breadcrumbs:pe,children:[e.jsx(W,{title:"Media Library"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"border overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center border-b p-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Media Library (",N,")"]}),e.jsxs(_,{className:"cursor-pointer",onClick:()=>D(!0),variant:"outline",children:[e.jsx(X,{})," Add Media"]}),e.jsx(de,{open:w,setOpen:D,onUploadComplete:I})]}),e.jsx("div",{className:"px-4 mt-4 flex justify-end",children:e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx(L,{type:"text",placeholder:"Search...",className:"pl-10 pr-4",value:h,onChange:t=>b(t.target.value)}),e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4",children:[j.length===0&&!s&&e.jsx("div",{className:"col-span-full text-center text-gray-500",children:"No media found."}),j.map(t=>e.jsx("div",{className:"border rounded overflow-hidden group relative hover:shadow-md transition-shadow",children:e.jsx("img",{src:`/storage/${t.path}?t=${t.updated_at||Date.now()}`,alt:t.name||"Image",className:"object-cover object-center w-full rounded-lg h-40 cursor-pointer",onClick:()=>{y(t),u(!0)}})},t.id))]}),v&&e.jsx("div",{className:"text-center mb-4",children:e.jsx(_,{onClick:$,variant:"default",disabled:s,children:s?e.jsx(ne,{className:"animate-spin"}):"Load More"})})]})})}),e.jsx(me,{open:i,setOpen:u,media:n,setMedia:y,mediaList:j,onMediaUpdate:t=>{!t&&n?(p(k=>k.filter(d=>d.id!==n.id)),y(null),u(!1)):t&&(p(k=>k.map(d=>d.id===t.id?t:d)),y(t))}})]})};export{Ie as default};
